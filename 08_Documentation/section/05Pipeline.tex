
\section{Pipeline Implementation: Modules Implemented and Mathematical Explanation}
\label{sec:Mathematical Models and Algorithms for Radar-Based Object Detection}

To reliably interpret radar sensor data for static object detection and ego-motion estimation, a modular processing pipeline was developed. 
This pipeline supports both single-radar and dual-radar configurations, in both cases the inclusion of an Inertial Measurement Unit (IMU) is needed to compensate for rotational motion of the platform. 
The modular design allows adaptation to different vehicle setups and deployment conditions.

\subsection*{Sensor Data Preprocessing}
In the preprocessing of the radar data, there are two scenarios that were implemented for this project, the single-radar setup and the dual-radar setup with IMU integration.
In both radar setups, radar data is received over UART in the form of raw frames containing point cloud information. 
Each point includes its spatial coordinates $(x, y, z)$, radial velocity $v_r$, side-point info; this information comes with signal-to-noise ratio (SNR) and noise ration (dB) values that indicate the quality of each detection and range profile data.

The raw bytes are decoded \cite{understanding_uart} and structured into frame objects, which are then passed through a Physical Transformation module. 
This step converts from the sensor frame coordinates into the vehicle local frame, accounting for radar mounting position and orientation. 
This can be consider a rigid body transformation involving rotation and translation matrices.
However is really important that this process of rigid transformation is done, as the data that we obtain from the sensor does not know where it is in the vehicle, creating a missalignment between the radar data and the vehicle frame of reference.

\subsubsection*{Dual-Radar and IMU Integration}
In the enhanced dual-radar configuration, two front-facing radar sensors—mounted on the left and right sides—provide overlapping fields of view. 
Their data streams are synchronized and passed through an IMU module before aggregation.
Before being fused in the IMU module, both radar streams undergo an initial Physical Transformation step to account for their respective mounting positions.
The IMU plays a critical role in estimating the rotation of the system (typically yaw, $\theta$), which is then used to correctly transform radar point clouds into a common reference frame. 
This correction is essential when performing operations such as frame aggregation and ego-motion estimation, especially during turning maneuvers or curved trajectories.
By incorporating rotation from the IMU, we avoid accumulating drift in the pose estimation and ensure consistent alignment across frames. 
The rotation is applied as a transformation matrix $R(\theta)$ during the aggregation step.

\subsection*{Frame Aggregation}
Radar point clouds are naturally sparse, especially at longer ranges. 
To improve stability and robustness, consecutive frames are aggregated into a local submap. 
This approach increases point density, reduces the effect of random noise, and provides a richer structure for downstream tasks such as clustering and alignment. 
The aggregation is performed after IMU-based alignment, ensuring that the fused frames are geometrically consistent. 

\subsection*{Filtering and Self-Speed Estimation}
Once points are aggregated and aligned, the pipeline performs filtering in two stages:

\begin{itemize}
    \item \textbf{Coordinate and SNR Filtering:} Removes points outside valid spatial boundaries or below a configurable SNR threshold.
    \item \textbf{Velocity-based Filtering:} Compares each point's Doppler-derived velocity $v_r$ against the estimated self-velocity $v_e$ to remove static or inconsistent returns. This step also serves as a soft segmentation between dynamic and static points.
\end{itemize}

Self-speed estimation is derived from the filtered points and refined using a Kalman filter to stabilize fluctuations. This self-speed value is used both for filtering and for downstream modules.

\subsection*{Clustering and Outlier Rejection}
The filtered detections are grouped into clusters to structure the radar scene. 
A two-stage clustering approach is applied: an initial permissive grouping followed by stricter refinement to remove noise and assign stable cluster identifiers.  
To prevent spurious points from corrupting the process, RANSAC-based outlier rejection is performed beforehand, ensuring that only consistent detections are retained for cluster formation.

\subsection*{ICP Alignment and Ego-Motion Estimation}
The final stage of the pipeline performs frame-to-frame alignment using Iterative Closest Point (ICP).  
Clusters from the current frame (or submap) are matched against those from the previous frame, and the transformation that minimizes the alignment error is computed.  
This transformation directly corresponds to the vehicle ego-motion.  
By combining the ICP-derived translation with the IMU-provided rotation, the pipeline yields a robust odometry estimate even in degraded or high-speed environments.

\begin{figure}[!htbp]
    \centering
    \resizebox{0.48\textwidth}{!}{
        \begin{tikzpicture}
            % Block style
            \tikzstyle{block} = [rectangle, draw, text width=4.5em, text centered, minimum width=6em, minimum height=4em]

            % Upper row
            \node[block] (uart) {UART\\Data};
            \node[block, right=of uart] (decoder) {Data decoder};
            \node[block, right=of decoder] (frames) {Frame};
            \node[block, right=of frames] (transform) {Physical\\Transformations};
            \node[block, right=of transform] (frame_aggr) {Frame\\Aggregator};
            \node[block, right=of frame_aggr] (coord_filter) {Filter\\$x,y,z$\\$\phi$, SNR};
            \node[block, right=of coord_filter] (ransac) {RANSAC};
            \node[block, right=of ransac] (doppler_filter) {Filter\\Zero Doppler};
            \node[block, right=of doppler_filter] (clustering) {Clustering};
            \node[block, right=of clustering] (icp) {ICP};
            \node[block, right=of icp] (ego) {Ego-motion};

            % IMU and self-speed estimator (below RANSAC)
            \node[block, below=1.5cm of decoder] (imu) {IMU\\Data};
            \node[block, below=1.5cm of ransac] (self_speed_estim) {Self-speed Estimator};
            \node[block, right=of self_speed_estim] (self_speed_kalman) {Kalman Filter};

            % Connections
            \draw[->] (uart) -- (decoder);
            \draw[->] (decoder) -- (frames);
            \draw[->] (frames) -- (transform);
            \draw[->] (transform) -- (frame_aggr);
            \draw[->] (imu.east) -| ([yshift=-1.5em]frame_aggr.south) -| (frame_aggr.south);

            \draw[->] (frame_aggr) -- (coord_filter);
            \draw[->] (coord_filter) -- (ransac);
            \draw[->] (ransac) -- (doppler_filter);
            \draw[->] (doppler_filter) -- (clustering);
            \draw[->] (clustering) -- (icp);
            \draw[->] (icp) -- (ego);

            \draw[->] (ransac.south) -- (self_speed_estim.north);
            \draw[->] (self_speed_estim) -- (self_speed_kalman);

            % Bottom brace for preprocessing
            \draw [decorate, decoration = {brace, mirror, raise=10pt}]
                (uart.south west) -- (transform.south east)
                node[pos=0.5,below=15pt,black]{Sensor Data Preprocessing};
        \end{tikzpicture}
    }
    \caption{Single Radar Pipeline}
    \label{fig:single_radar_pipeline}
\end{figure}



\begin{figure}[!htbp]
    \centering
    \resizebox{0.48\textwidth}{!}{
        \begin{tikzpicture}
            % Block style
            \tikzstyle{block} = [rectangle, draw, text width=4.5em, text centered, minimum width=6em, minimum height=4em]

            % Input branches
            \node[block] (radar1) {Radar\\Front Left};
            \node[block, below=1.2cm of radar1] (radar2) {Radar\\Front Right};

            % Physical transformation
            \node[block, right=1.8cm of radar1] (transform1) {Physical\\Transform};
            \node[block, below=1.2cm of transform1] (transform2) {Physical\\Transform};

            % Merge and processing
            \node[block, right=1.8cm of transform1] (merge) {Radar Merge};
            \node[block, right=of merge] (imu) {IMU};
            \node[block, right=of imu] (frame_aggr) {Frame\\Aggregator};
            \node[block, right=of frame_aggr] (coord_filter) {Filter\\$x,y,z$\\$\phi$, SNR};
            \node[block, right=of coord_filter] (ransac) {RANSAC};
            \node[block, right=of ransac] (doppler_filter) {Filter\\Zero Doppler};
            \node[block, right=of doppler_filter] (clustering) {Clustering};
            \node[block, right=of clustering] (icp) {ICP};
            \node[block, right=of icp] (ego) {Ego-motion};

            % Self-speed estimator (below RANSAC)
            \node[block, below=1.5cm of ransac] (self_speed_estim) {Self-speed Estimator};
            \node[block, right=of self_speed_estim] (self_speed_kalman) {Kalman Filter};

            % Connections
            \draw[->] (radar1) -- (transform1);
            \draw[->] (radar2) -- (transform2);
            \draw[->] (transform1) -- (merge);
            \draw[->] (transform2) -| (merge);
            \draw[->] (merge) -- (imu);
            \draw[->] (imu) -- (frame_aggr);
            \draw[->] (frame_aggr) -- (coord_filter);
            \draw[->] (coord_filter) -- (ransac);
            \draw[->] (ransac) -- (doppler_filter);
            \draw[->] (doppler_filter) -- (clustering);
            \draw[->] (clustering) -- (icp);
            \draw[->] (icp) -- (ego);

            \draw[->] (ransac.south) -- (self_speed_estim.north);
            \draw[->] (self_speed_estim) -- (self_speed_kalman);

            % Bottom brace under radar2
            \draw [decorate, decoration = {brace, mirror, raise=8pt}] 
                ([xshift=-2em,yshift=-1em]radar2.south west) -- 
                ([xshift=2em,yshift=-1em]radar2.south east)
                node[midway, below=12pt] {Dual-Radar Inputs};
        \end{tikzpicture}
    }
    \caption{Dual Radar Pipeline}
    \label{fig:dual_radar_pipeline}
\end{figure}


\FloatBarrier\noindent